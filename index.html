<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÊàëÁöÑÊóÖË°åË∂≥Ëøπ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #0a0a0f;
    color: #e0e0e0;
    overflow: hidden;
    height: 100vh;
  }

  /* ===== Header ===== */
  .header {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 1000;
    padding: 16px 32px;
    background: linear-gradient(180deg, rgba(10,10,15,0.95) 0%, rgba(10,10,15,0.7) 70%, transparent 100%);
    display: flex;
    align-items: center;
    justify-content: space-between;
    pointer-events: none;
  }
  .header > * { pointer-events: auto; }
  .header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 1px;
  }
  .header .stats {
    display: flex;
    gap: 24px;
    font-size: 0.85rem;
    color: #94a3b8;
  }
  .stats span strong {
    color: #60a5fa;
    font-size: 1.1rem;
  }

  /* ===== Map ===== */
  #map {
    width: 100%;
    height: 100vh;
  }
  .leaflet-container { background: #0a0a0f; }

  /* Custom marker */
  .custom-marker {
    background: radial-gradient(circle, #60a5fa 0%, #3b82f6 50%, transparent 70%);
    border-radius: 50%;
    box-shadow: 0 0 8px 3px rgba(96,165,250,0.4);
    animation: pulse 2.5s ease-in-out infinite;
    cursor: pointer;
    transition: transform 0.2s, width 0.3s, height 0.3s;
  }
  .custom-marker:hover {
    transform: scale(1.8);
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 8px 3px rgba(96,165,250,0.4); }
    50% { box-shadow: 0 0 14px 6px rgba(96,165,250,0.6); }
  }

  /* Popup override */
  .leaflet-popup-content-wrapper {
    background: rgba(15,15,25,0.95) !important;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(96,165,250,0.2);
    border-radius: 16px !important;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5) !important;
    padding: 0 !important;
    overflow: hidden;
    max-width: 380px;
  }
  .leaflet-popup-content { margin: 0 !important; width: auto !important; }
  .leaflet-popup-tip { background: rgba(15,15,25,0.95) !important; }
  .leaflet-popup-close-button {
    color: #94a3b8 !important;
    font-size: 20px !important;
    top: 8px !important;
    right: 12px !important;
    z-index: 10;
  }
  .leaflet-popup-close-button:hover { color: #fff !important; }

  /* Popup inner content */
  .popup-card { width: 340px; }
  .popup-card .popup-header {
    padding: 20px 20px 12px;
  }
  .popup-card .popup-header h3 {
    font-size: 1.15rem;
    font-weight: 700;
    color: #f1f5f9;
    margin-bottom: 4px;
  }
  .popup-card .popup-header .location-meta {
    font-size: 0.8rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .popup-card .popup-header .location-meta svg {
    width: 14px; height: 14px;
    fill: #64748b;
  }
  .popup-card .popup-desc {
    padding: 0 20px 16px;
    font-size: 0.85rem;
    color: #94a3b8;
    line-height: 1.5;
  }
  .popup-card .photo-grid {
    display: grid;
    gap: 3px;
    padding: 0 3px 3px;
  }
  .popup-card .photo-grid.cols-1 { grid-template-columns: 1fr; }
  .popup-card .photo-grid.cols-2 { grid-template-columns: 1fr 1fr; }
  .popup-card .photo-grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
  .popup-card .photo-grid img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.2s;
    display: block;
  }
  .popup-card .photo-grid img:hover {
    opacity: 0.8;
    transform: scale(1.03);
  }
  .popup-card .photo-grid.cols-1 img { height: 200px; border-radius: 0 0 12px 12px; }

  /* ===== Lightbox ===== */
  .lightbox {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0,0,0,0.92);
    backdrop-filter: blur(10px);
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }
  .lightbox.active { display: flex; }
  .lightbox img {
    max-width: 90vw;
    max-height: 80vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 0 80px rgba(96,165,250,0.15);
  }
  .lightbox .lb-caption {
    margin-top: 16px;
    color: #94a3b8;
    font-size: 0.9rem;
  }
  .lightbox .lb-close {
    position: absolute;
    top: 24px; right: 32px;
    font-size: 2rem;
    color: #64748b;
    cursor: pointer;
    transition: color 0.2s;
    background: none; border: none;
    line-height: 1;
  }
  .lightbox .lb-close:hover { color: #fff; }
  .lightbox .lb-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2.5rem;
    color: #64748b;
    cursor: pointer;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 50%;
    width: 52px; height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .lightbox .lb-nav:hover { color: #fff; background: rgba(255,255,255,0.1); }
  .lightbox .lb-prev { left: 24px; }
  .lightbox .lb-next { right: 24px; }
  .lightbox .lb-counter {
    position: absolute;
    bottom: 24px;
    color: #64748b;
    font-size: 0.85rem;
  }

  /* ===== Sidebar List (optional) ===== */
  .sidebar-toggle {
    position: fixed;
    bottom: 24px; left: 24px;
    z-index: 1001;
    background: rgba(15,15,25,0.9);
    border: 1px solid rgba(96,165,250,0.3);
    color: #60a5fa;
    padding: 10px 18px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 0.85rem;
    backdrop-filter: blur(10px);
    transition: all 0.2s;
  }
  .sidebar-toggle:hover {
    background: rgba(96,165,250,0.15);
    border-color: #60a5fa;
  }
  .sidebar {
    position: fixed;
    left: -360px;
    top: 0; bottom: 0;
    width: 340px;
    z-index: 1002;
    background: rgba(10,10,18,0.97);
    backdrop-filter: blur(20px);
    border-right: 1px solid rgba(96,165,250,0.1);
    transition: left 0.35s cubic-bezier(0.4,0,0.2,1);
    overflow-y: auto;
    padding: 80px 20px 20px;
  }
  .sidebar.open { left: 0; }
  .sidebar h2 {
    font-size: 1rem;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 16px;
  }
  .sidebar .view-toggle {
    display: flex;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(96,165,250,0.12);
    border-radius: 10px;
    margin-bottom: 12px;
    overflow: hidden;
  }
  .sidebar .view-toggle button {
    flex: 1;
    padding: 8px 0;
    background: none;
    border: none;
    color: #64748b;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.25s;
  }
  .sidebar .view-toggle button.active {
    background: rgba(96,165,250,0.15);
    color: #60a5fa;
  }
  .sidebar .view-toggle button:hover:not(.active) {
    color: #94a3b8;
  }
  .sidebar .search-box {
    width: 100%;
    padding: 10px 14px;
    border-radius: 10px;
    border: 1px solid rgba(96,165,250,0.15);
    background: rgba(255,255,255,0.04);
    color: #e2e8f0;
    font-size: 0.85rem;
    outline: none;
    margin-bottom: 16px;
    transition: border-color 0.2s;
  }
  .sidebar .search-box::placeholder { color: #475569; }
  .sidebar .search-box:focus { border-color: rgba(96,165,250,0.5); }
  .sidebar .country-group { margin-bottom: 6px; }
  .sidebar .country-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.2s;
    user-select: none;
  }
  .sidebar .country-header:hover { background: rgba(96,165,250,0.08); }
  .sidebar .country-header h3 {
    font-size: 0.9rem;
    color: #e2e8f0;
    font-weight: 600;
  }
  .sidebar .country-header .country-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    color: #64748b;
  }
  .sidebar .country-header .arrow {
    transition: transform 0.25s;
    color: #475569;
    font-size: 0.7rem;
  }
  .sidebar .country-header.open .arrow { transform: rotate(90deg); }
  .sidebar .country-cities {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s cubic-bezier(0.4,0,0.2,1);
  }
  .sidebar .country-cities.open { max-height: 2000px; }
  .sidebar .place-item {
    padding: 10px 16px 10px 28px;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.2s;
    margin-bottom: 2px;
  }
  .sidebar .place-item:hover { background: rgba(96,165,250,0.08); }
  .sidebar .place-item h4 {
    color: #cbd5e1;
    font-size: 0.88rem;
    margin-bottom: 2px;
  }
  .sidebar .place-item p {
    color: #64748b;
    font-size: 0.75rem;
    line-height: 1.4;
  }
  .sidebar .trip-tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 6px;
    background: rgba(96,165,250,0.1);
    color: #60a5fa;
    font-size: 0.7rem;
    margin: 2px 4px 2px 0;
    cursor: pointer;
    transition: background 0.2s;
  }
  .sidebar .trip-tag:hover { background: rgba(96,165,250,0.25); }
  /* Timeline view */
  .sidebar .timeline-group { margin-bottom: 6px; }
  .sidebar .timeline-month {
    padding: 8px 14px 4px;
    font-size: 0.75rem;
    font-weight: 600;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: sticky;
    top: 0;
    background: rgba(10,10,18,0.95);
    z-index: 1;
  }
  .sidebar .timeline-item {
    padding: 10px 16px 10px 28px;
    border-left: 2px solid rgba(96,165,250,0.15);
    margin-left: 20px;
    border-radius: 0 10px 10px 0;
    cursor: pointer;
    transition: background 0.2s, border-color 0.2s;
    margin-bottom: 2px;
    position: relative;
  }
  .sidebar .timeline-item::before {
    content: '';
    position: absolute;
    left: -5px;
    top: 15px;
    width: 8px;
    height: 8px;
    background: #3b82f6;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(96,165,250,0.5);
  }
  .sidebar .timeline-item:hover {
    background: rgba(96,165,250,0.08);
    border-left-color: rgba(96,165,250,0.4);
  }
  .sidebar .timeline-item h4 {
    color: #cbd5e1;
    font-size: 0.88rem;
    margin-bottom: 2px;
  }
  .sidebar .timeline-item p {
    color: #64748b;
    font-size: 0.75rem;
  }
  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 1001;
  }
  .sidebar-overlay.open { display: block; }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1>‚ú¶ ÊàëÁöÑÊóÖË°åË∂≥Ëøπ</h1>
  <div class="stats">
    <span><strong id="stat-countries">0</strong> ‰∏™ÂõΩÂÆ∂</span>
    <span><strong id="stat-cities">0</strong> ‰∏™ÂüéÂ∏Ç</span>
    <span><strong id="stat-photos">0</strong> Âº†ÁÖßÁâá</span>
  </div>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Sidebar -->
<button class="sidebar-toggle" onclick="toggleSidebar()">üìç Âú∞ÁÇπÂàóË°®</button>
<div class="sidebar" id="sidebar"></div>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <button class="lb-close" onclick="closeLightbox()">√ó</button>
  <button class="lb-nav lb-prev" onclick="navLightbox(-1)">‚Äπ</button>
  <button class="lb-nav lb-next" onclick="navLightbox(1)">‚Ä∫</button>
  <img id="lb-img" src="" alt="">
  <div class="lb-caption" id="lb-caption"></div>
  <div class="lb-counter" id="lb-counter"></div>
</div>

<script src="data.js"></script>
<script>

// Init map
const map = L.map('map', {
  center: [25, 10],
  zoom: 3,
  minZoom: 2,
  maxZoom: 18,
  zoomControl: false,
  attributionControl: false
});

L.control.zoom({ position: 'bottomright' }).addTo(map);

// Dark tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OpenStreetMap ¬© CARTO',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

// Lightbox state
let lbPhotos = [];
let lbIndex = 0;

function openLightbox(photos, index) {
  lbPhotos = photos;
  lbIndex = index;
  updateLightbox();
  document.getElementById('lightbox').classList.add('active');
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
}

function navLightbox(dir) {
  lbIndex = (lbIndex + dir + lbPhotos.length) % lbPhotos.length;
  updateLightbox();
}

function updateLightbox() {
  document.getElementById('lb-img').src = lbPhotos[lbIndex].url;
  document.getElementById('lb-caption').textContent = lbPhotos[lbIndex].caption || '';
  document.getElementById('lb-counter').textContent = `${lbIndex + 1} / ${lbPhotos.length}`;
}

// Keyboard nav
document.addEventListener('keydown', (e) => {
  if (!document.getElementById('lightbox').classList.contains('active')) return;
  if (e.key === 'Escape') closeLightbox();
  if (e.key === 'ArrowLeft') navLightbox(-1);
  if (e.key === 'ArrowRight') navLightbox(1);
});

// Build popup HTML
function createPopupHTML(place) {
  const colClass = place.photos.length === 1 ? 'cols-1' : place.photos.length === 2 ? 'cols-2' : 'cols-3';
  const photosHTML = place.photos.map((p, i) =>
    `<img src="${p.url}" alt="${p.caption || ''}" loading="lazy" onclick="openLightbox(travelData.find(d=>d.name==='${place.name}').photos, ${i})" />`
  ).join('');

  return `
    <div class="popup-card">
      <div class="popup-header">
        <h3>${place.name}</h3>
        <div class="location-meta">
          <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
          ${place.country} ¬∑ ${place.date}
        </div>
      </div>
      <div class="popup-desc">${place.description}</div>
      <div class="photo-grid ${colClass}">${photosHTML}</div>
    </div>
  `;
}

// Marker size based on zoom
function getMarkerSize(zoom) {
  if (zoom <= 3) return 6;
  if (zoom <= 5) return 10;
  if (zoom <= 8) return 14;
  return 18;
}

function updateMarkerSizes() {
  const zoom = map.getZoom();
  const size = getMarkerSize(zoom);
  document.querySelectorAll('.custom-marker').forEach(el => {
    el.style.width = size + 'px';
    el.style.height = size + 'px';
  });
}

// Add markers
const markers = [];
travelData.forEach(place => {
  const initSize = getMarkerSize(map.getZoom());
  const icon = L.divIcon({
    className: 'custom-marker',
    iconSize: [initSize, initSize],
    iconAnchor: [initSize / 2, initSize / 2]
  });

  const marker = L.marker(place.coords, { icon })
    .addTo(map)
    .bindPopup(createPopupHTML(place), {
      maxWidth: 360,
      minWidth: 340,
      closeButton: true,
      className: ''
    });

  markers.push({ marker, place });
});

// Draw path line connecting locations (optional ‚Äî chronological route)
const sortedCoords = [...travelData]
  .sort((a, b) => a.date.localeCompare(b.date))
  .map(p => p.coords);

L.polyline(sortedCoords, {
  color: 'rgba(96,165,250,0.15)',
  weight: 1.5,
  dashArray: '6 8'
}).addTo(map);

// Update marker size on zoom
map.on('zoomend', updateMarkerSizes);
updateMarkerSizes();

// Stats
const countries = new Set(travelData.map(p => p.country));
document.getElementById('stat-countries').textContent = countries.size;
document.getElementById('stat-cities').textContent = travelData.length;
document.getElementById('stat-photos').textContent = travelData.reduce((s, p) => s + p.photos.length, 0);

// Sidebar
let currentView = 'country'; // 'country' or 'timeline'

function buildSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.innerHTML = '<h2>ÊâÄÊúâÂú∞ÁÇπ</h2>';

  // View toggle
  const toggle = document.createElement('div');
  toggle.className = 'view-toggle';
  toggle.innerHTML = `
    <button data-view="country" class="${currentView === 'country' ? 'active' : ''}">üåç ÊåâÂõΩÂÆ∂</button>
    <button data-view="timeline" class="${currentView === 'timeline' ? 'active' : ''}">üïê Êó∂Èó¥Á∫ø</button>
  `;
  toggle.querySelectorAll('button').forEach(btn => {
    btn.onclick = () => {
      currentView = btn.dataset.view;
      buildSidebar();
    };
  });
  sidebar.appendChild(toggle);

  // Search box
  const search = document.createElement('input');
  search.className = 'search-box';
  search.placeholder = 'üîç ÊêúÁ¥¢ÂüéÂ∏ÇÊàñÂõΩÂÆ∂...';
  search.oninput = () => filterSidebar(search.value.trim().toLowerCase());
  sidebar.appendChild(search);

  const container = document.createElement('div');
  container.id = 'sidebar-list';

  if (currentView === 'country') {
    buildCountryView(container);
  } else {
    buildTimelineView(container);
  }

  sidebar.appendChild(container);
}

function buildCountryView(container) {
  // Group by country
  const grouped = {};
  travelData.forEach((place, i) => {
    if (!grouped[place.country]) grouped[place.country] = [];
    grouped[place.country].push({ ...place, _index: i });
  });

  Object.keys(grouped).sort().forEach(country => {
    const places = grouped[country];
    const group = document.createElement('div');
    group.className = 'country-group';
    group.dataset.country = country.toLowerCase();

    // Merge cities
    const cityMap = {};
    places.forEach(p => {
      if (!cityMap[p.name]) cityMap[p.name] = [];
      cityMap[p.name].push(p);
    });
    const cityCount = Object.keys(cityMap).length;
    const tripCount = places.length;

    const header = document.createElement('div');
    header.className = 'country-header';
    header.innerHTML = `
      <h3>${country}</h3>
      <div class="country-meta">
        <span>${cityCount} ÂüéÂ∏Ç${tripCount > cityCount ? ' ¬∑ ' + tripCount + ' Ê¨°' : ''}</span>
        <span class="arrow">‚ñ∂</span>
      </div>
    `;
    header.onclick = () => {
      header.classList.toggle('open');
      citiesDiv.classList.toggle('open');
    };
    group.appendChild(header);

    const citiesDiv = document.createElement('div');
    citiesDiv.className = 'country-cities';

    Object.keys(cityMap).forEach(cityName => {
      const trips = cityMap[cityName];
      const item = document.createElement('div');
      item.className = 'place-item';
      item.dataset.name = cityName.toLowerCase();

      const totalPhotos = trips.reduce((s, t) => s + t.photos.length, 0);

      if (trips.length === 1) {
        const t = trips[0];
        item.innerHTML = `<h4>${cityName}</h4><p>${t.date} ¬∑ ${totalPhotos} Âº†ÁÖßÁâá</p>`;
        item.onclick = () => flyToPlace(t._index);
      } else {
        const tags = trips.map(t =>
          `<span class="trip-tag" data-idx="${t._index}">${t.date}</span>`
        ).join('');
        item.innerHTML = `<h4>${cityName} <span style="color:#64748b;font-weight:400;font-size:0.75rem">${trips.length}Ê¨°</span></h4>
          <p>${totalPhotos} Âº†ÁÖßÁâá</p>
          <div style="margin-top:4px">${tags}</div>`;
        item.querySelectorAll('.trip-tag').forEach(tag => {
          tag.onclick = (e) => {
            e.stopPropagation();
            flyToPlace(parseInt(tag.dataset.idx));
          };
        });
        item.onclick = () => flyToPlace(trips[0]._index);
      }
      citiesDiv.appendChild(item);
    });

    group.appendChild(citiesDiv);
    container.appendChild(group);
  });
}

function buildTimelineView(container) {
  // Sort by date descending (newest first)
  const sorted = travelData.map((p, i) => ({ ...p, _index: i }))
    .sort((a, b) => b.date.localeCompare(a.date));

  let currentMonth = '';

  sorted.forEach(place => {
    const monthKey = place.date; // e.g. "2024-03"
    if (monthKey !== currentMonth) {
      currentMonth = monthKey;
      const monthLabel = document.createElement('div');
      monthLabel.className = 'timeline-month';
      // Format: "2024-03" ‚Üí "2024 Âπ¥ 3 Êúà"
      const [y, m] = monthKey.split('-');
      monthLabel.textContent = `${y} Âπ¥ ${parseInt(m)} Êúà`;
      container.appendChild(monthLabel);
    }

    const item = document.createElement('div');
    item.className = 'timeline-item';
    item.dataset.name = place.name.toLowerCase();
    item.dataset.country = place.country.toLowerCase();
    item.innerHTML = `<h4>${place.name}</h4><p>${place.country} ¬∑ ${place.photos.length} Âº†ÁÖßÁâá</p>`;
    item.onclick = () => flyToPlace(place._index);
    container.appendChild(item);
  });
}

function flyToPlace(index) {
  const place = travelData[index];
  map.flyTo(place.coords, 12, { duration: 1.5 });
  markers[index].marker.openPopup();
  toggleSidebar();
}

function filterSidebar(query) {
  if (currentView === 'country') {
    document.querySelectorAll('.country-group').forEach(group => {
      const country = group.dataset.country;
      const items = group.querySelectorAll('.place-item');
      let groupMatch = country.includes(query);
      let anyVisible = false;

      items.forEach(item => {
        const name = item.dataset.name;
        const visible = !query || groupMatch || name.includes(query);
        item.style.display = visible ? '' : 'none';
        if (visible) anyVisible = true;
      });

      group.style.display = anyVisible ? '' : 'none';

      if (query && anyVisible) {
        group.querySelector('.country-header').classList.add('open');
        group.querySelector('.country-cities').classList.add('open');
      } else if (!query) {
        group.querySelector('.country-header').classList.remove('open');
        group.querySelector('.country-cities').classList.remove('open');
      }
    });
  } else {
    // Timeline filter
    document.querySelectorAll('.timeline-item').forEach(item => {
      const name = item.dataset.name;
      const country = item.dataset.country;
      const visible = !query || name.includes(query) || country.includes(query);
      item.style.display = visible ? '' : 'none';
    });
    document.querySelectorAll('.timeline-month').forEach(label => {
      const next = [];
      let sib = label.nextElementSibling;
      while (sib && !sib.classList.contains('timeline-month')) {
        next.push(sib);
        sib = sib.nextElementSibling;
      }
      const anyVisible = next.some(el => el.style.display !== 'none');
      label.style.display = anyVisible ? '' : 'none';
    });
  }
}

buildSidebar();

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('open');
}
</script>
</body>
</html>
